<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>【滋恩】一级碧螺春罐装70g</title>
    <link rel="shortcut icon" href="images/20190906170231_64693_32.ico" type="image/x-icon" />
    <meta name="Keywords" content="【滋恩】一级碧螺春罐装70g" />
    <meta name="Description" content="【滋恩】一级碧螺春罐装70g" />
    <link href="http://www.hecha.cn/" rel="canonical" />
    <link rel="stylesheet" type="text/css" href="http://www.hecha.cn/css/QuHeCha/Index/main.css">
    <link rel="stylesheet" type="text/css" href="http://www.hecha.cn/themes/hechav3/skin1/style/goods.css">
    <style type="text/css">
        .hc_lnav .allbtn ul {
            display: none;
        }
    </style>
</head>

<body>
    <!-- 顶部 -->
    <div class="top-pic">
        <img src="images/toppic.png">
    </div>
    <div class="top">
        <div class="con clearfix">
            <div class="fl" id="loginModel">
                <a href="http://www.hecha.cn/cn/register.html" target="_blank" id="registerLink">注册</a>
                <a href="http://www.hecha.cn/cn/login.html" class="login" target="_blank" id="loginLink">登陆</a>
            </div>
            <div class="fr">
                <a href="http://www.hecha.cn/cn/UserInfo/OrderList.html" class="order-bg" id="myHechaLink">
                    <i class="order"><img src="http://www.hecha.cn/images/QuHeCha/Index/order.png"></i>我的订单
                </a>
                <i class="weChat"><img src="http://www.hecha.cn/images/QuHeCha/Index/wx.png"></i>服务热线：
                <a>188-6042-4332</a>
            </div>
        </div>
    </div>
    <div class="head">
        <div class="con clearfix">
            <div class="fl logo"><a href="taotao.html" target="_blank"><img src="images/logo.png"></a></div>
            <div class="fl brand"><img src="images/brand.gif"></div>

            <div class="fr goods-cart">
                <i class="code"></i>
                <a href="http://www.hecha.cn/cn/Cart.html">
                    <i class="cart"></i>
                    <span>购物车（<span id="cartCount"></span>）</span>
                </a>
            </div>
        </div>
    </div>
    <script src="js/ajax+jsonp.js"></script>


    <!-- 主页面 -->

    <div class="hc_main">
        <div class="hc_goodsinfo">
            <div class="imgbox">
                <div style="position: relative;" class="bigimg">
                        <a style="cursor: crosshair; display: block; position: relative; height: 380px; width: 380px;
                          outline-style: none; text-align:center ; border:1px solid #ccc" target="_blank" class="Img">
                        </a>
                </div>
            </div>
            <div class="txtbox" data="goods_info" alt="soldout">
                <input type="hidden" id="ProductBandCategory"
                    value="9832dfa9-9abd-4d85-9904-8c1420d21787_e59acaf7-4bd2-4de3-9791-c9145a7236d2_c64628f6-b0c3-4093-a91c-5893bd809113_9312da1e-18f6-4cfc-ab8e-ea2c81a5d71d" />
                <h1 id="lgoodname">
                     <span id="emailkc"></span>
                    <input id="pdataID" type="hidden" value="9832dfa9-9abd-4d85-9904-8c1420d21787" />
                    <input id="pID" type="hidden" value="d78e8b40-55e2-49b5-ae6f-9be0365d3d52" />
                </h1>
                <ul class="pri" style="position:relative">
                    <li class="t4"><del id="hechaPrice"></del></li>
                    <div class="clear line20">
                    </div>
                    <div class="SecDiv" style="display:none;" id="timer"></div>
                </ul>
                <ul class="info3">
                    <li class="t1 crz">
                        <p class="left">
                            我要购买：
                        </p>
                        <div class="goods_inp">
                            <input type="number" style="width:70px">
                        </div>
                        <p>
                            件
                        </p>
                        <p class="goods_inp_info">
                            <span style="display: none;">最多只能购买99件</span>
                        </p>
                    </li>
                    <!--立即购买-->
                    <li class="buy" id="nowbuy">
                        <a id="NowShop" onclick="return btnAddd_ToCart('9832dfa9-9abd-4d85-9904-8c1420d21787');"
                            target="_blank" href="http://www.hecha.cn/cn/Cart.html">
                            <img src="http://www.hecha.cn/themes/hechav3/skin1/images/home/goodsinfo_buy1.png"
                                style="width:163px;height:35px;">
                        </a>
                    </li>
                    <!--加入购物车-->
                    <li class="buy" id="nowcart">
                        <a id="AddShopCart" onclick="return btnAddd_ToCart('9832dfa9-9abd-4d85-9904-8c1420d21787');"
                            target="_blank" href="http://www.hecha.cn/cn/Cart.html">
                            <img src="http://www.hecha.cn/themes/hechav3/skin1/images/home/goodsinfo_buy2.png"
                                style="width:163px;height:35px;">
                        </a>
                    </li>
                    <div class="clear">
                    </div>
                </ul>
                <ul class="info4">
                    <li class="t1">本商品已缺货，正在补货</li>
                </ul>
            </div>
            <div class="probox">

                <div class="hc_proli_r1 probox_rlist1">
                    <div class="swiper-wrapper" style="width: 190px; height: 2188px; transform: translate3d(0px, -547px, 0px);
                    -webkit-transform: translate3d(0px, -547px, 0px); transition: 0s; -webkit-transition: 0s;">
                    </div>
                    <div class="clear">
                    </div>
                </div>
                <a class="goods1_slide-prev" href="#"></a><a class="goods1_slide-next" href="#">
                </a>
            </div>
            <div class="clear">
            </div>
        </div>
        <div class="clear line15">
        </div>
    </div>
</body>
<script>

    (function () {
        class Data {
            constructor() {
                this.url = "http://localhost/quhecha/data/goods.json";
                this.Img = document.getElementsByClassName("Img")[0]
                this.emailkc=document.getElementById("emailkc")
                this.t4=document.getElementsByClassName("t4")[0]
                this.gid = window.location.href.split('?')[1];
                console.log(this.gid);
                this.load();
                // 1.准备绑定点击事件
                this.addEvent();
            }
            load() {
                var that = this;
                ajax({
                    url: this.url,
                    success: function (res) {
                        // console.log(res)
                        that.res = JSON.parse(res)
                        that.display();
                    }
                })

            }
            display() {
                // console.log(this.res);
                var str = "";
                var str1="";
                var str2="";
                for (var i = 0; i < this.res.length; i++) {
                    if (this.res[i].goodsId == this.gid) {
                        this.goods = this.res[i]

                    }
                }
                console.log(this.bigimg)
                str += `<img src="${this.goods.url}" class="jqzoom" height="380" width="380" alt="" style="cursor: crosshair;">`;
                this.Img.innerHTML = str;
                str1+=`${this.goods.name}`
                this.emailkc.innerHTML=str1
                str2+=`和茶价${this.goods.price}￥`
                this.t4.innerHTML=str2
            }
            addEvent() {
                var that = this;
                this.box1.addEventListener("click", function (eve) {
                    var e = eve || window.event;
                    var target = e.target || e.srcElement;
                    if (target.className == "btn") {
                        // 2.提前找到点击商品的唯一的id
                        that.id = target.parentNode.getAttribute("index");
                        // 3.准备存储localstorage
                        that.setLocal();
                    }
                })
            }
            setLocal() {

                // 数据的格式：[{id:,num:,},{},{}]
                // 先读
                this.goods = localStorage.getItem("goods") ? JSON.parse(localStorage.getItem("goods")) : [];

                if (this.goods.length < 1) {
                    // 第一次存，直接存
                    this.goods.push({
                        id: this.id,
                        num: 1
                    })
                } else {
                    // 准备存重复数据的索引
                    var i;
                    // 利用some遍历数组，检测是否有重复数据
                    var o = this.goods.some((val, index) => {
                        // 每次将索引，保存出来，
                        i = index;
                        // 如果id重复了，返回true，同时some自动停止
                        return val.id == this.id;
                    })
                    // 如果some的返回值为true，表示肯定有一个值为true，那么表示有重复
                    if (o) {
                        this.goods[i].num++
                    } else { //否则没有重复，再新增数据
                        this.goods.push({
                            id: this.id,
                            num: 1
                        })
                    }

                }

                localStorage.setItem("goods", JSON.stringify(this.goods));
            }
        }

        new Data();
    })();

</script>

</html>